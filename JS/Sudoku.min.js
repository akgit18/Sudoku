const q=[e,p];function v(c,b,a){for(let d=1;d<w**2+1;++d)if(c[b][a]=d,x(c,b,a)){const f=y(c);if(f){if(v(c,f[0],f[1]))return!0}else return!0}c[b][a]=-1;return!1}function z(c,b=null){if(b)for(var a of b){if(!x(c,a[0],a[1]))return!1}else for(b=0;b<w*w;b++)for(a=0;a<w*w;a++)if(!x(c,b,a))return!1;return!0}function x(c,b,a){let d=c[b][a];if(d>w**2)throw Error(`Value ${d} on row ${b+1}, column ${a+1} too large.`);if(0<d)for(const f of q)if(!f(c,b,a,d))return!1;return!0}
function e(c,b,a,d){for(let f=0;f<w*w;f++)if(d==c[f][a]&&f!=b||d==c[b][f]&&f!=a)return!1;return!0}function p(c,b,a,d){let f=Math.floor(b/w)*w,l=Math.floor(a/w)*w;for(let g=0;g<w;g++)for(let h=0;h<w;h++)if((g+f!=b||h+l!=a)&&c[g+f][h+l]==d)return!1;return!0}function A(c,b,a,d){const f=[-2,-2,-1,-1,1,1,2,2],l=[-1,1,-2,2,-2,2,-1,1];for(let g=0;8>g;g++){const h=b+f[g],k=a+l[g];if(0<=h&&h<w**2&&0<=k&&k<w**2&&d==c[h][k])return!1}return!0}
function B(c,b,a,d){const f=[-1,-1,-1,0,0,1,1,1],l=[-1,0,1,-1,1,-1,0,1];for(let g=0;8>g;g++){const h=b+f[g],k=a+l[g];if(0<=h&&h<w**2&&0<=k&&k<w**2&&d==c[h][k])return!1}return!0}function C(c,b,a,d){let f=[-1,0,0,1],l=[0,-1,1,0];for(let g=0;4>g;g++){let h=b+f[g],k=a+l[g];if(0<=h&&h<w**2&&0<=k&&k<w**2&&(d+1==c[h][k]||d-1==c[h][k]))return!1}return!0}
function D(c,b){let a=b.value;b.checked?(c.className="col2",c=d=>{q.push(d)}):(c.className="lb1",c=d=>{q.splice(q.indexOf(d),1)});switch(a){case "1":c(A);break;case "2":c(B);break;case "3":c(C);break;default:alert("Attempting to toggle unknown rule")}}function y(c){for(let b=0;b<w**2;b++)for(let a=0;a<w**2;a++)if(1>c[b][a])return[b,a]}let E=(c,b,a)=>v(c,b,a);function H(c){for(let b=0;b<w**2;b++){let a=I.rows[b];for(let d=0;d<w**2;d++)a.cells[d].children[0].value=c[b][d]}}
function J(c){if(!z(c))throw Error("Inputted board not valid.");var b;let a=[];for(;b=y(c);)c[b[0]][b[1]]=K(c,b[0],b[1]),a.push(b);b=1E3*2**w;for(let d=0;d<b;d++){H(c);let f=a[Math.floor(Math.random()*a.length)];L(c,f[0],f[1])&&(c[f[0]][f[1]]=K(c,f[0],f[1]));if(z(c,a))return!0}throw Error(`${b} iterations exceeded without finding a solution.`);}
function L(c,b,a,d=c[b][a]){if(d>w**2)throw Error(`Value ${d} on row ${b+1}, column ${a+1} too large.`);let f=0;if(0<d)for(const l of M.get(100*b+a))d==c[l[0]][l[1]]&&f++;return f}function K(c,b,a){const d=w**2;let f=1,l=Infinity;for(let g=1;g<=d;g++){let h=L(c,b,a,g);h<l&&(l=h,f=g)}return f};let w=3;const I=document.getElementById("board"),M=new Map;
function N(){let c=!1;for(let m=0;m<w**2;m++){let r=I.insertRow(m);0==m%w&&(c=!c);for(let n=0;n<w**2;n++){(0<n||0==w%2)&&0==n%w&&(c=!c);r.insertCell(n).innerHTML=c?"<input inputmode='numeric' size='1' maxlength='2' autocomplete='off' class='col1'>":"<input inputmode='numeric' size='1' maxlength='2' autocomplete='off' class='col2'>";var b=M,a=b.set,d=100*m+n,f=m,l=n,g=f,h=l,k=[];const F=Math.floor(g/w)*w,G=Math.floor(h/w)*w;for(let t=0;t<w;++t)for(let u=0;u<w;++u)t+F==g&&u+G==h||k.push([t+F,u+G]);
g=k;h=[];for(k=0;k<w**2;++k)k!=f&&h.push([k,l]),k!=l&&h.push([f,k]);a.call(b,d,new Set(g.concat(h)))}}}
document.body.onload=()=>{N();document.getElementById("cboard").onclick=()=>{confirm("Are you sure? This will erase any data you have currently entered.")&&(I.removeChild(document.getElementsByTagName("tbody")[0]),N())};document.getElementById("sboard").onclick=()=>{try{const d=document.getElementById("board"),f=[];for(let g=0;g<w**2;g++){let h=d.rows[g],k=[];for(let m=0;m<w**2;m++){let r=h.cells[m].children[0].value;0<r?k.push(parseInt(r,10)):k.push(-1)}f.push(k)}var a=f;if(!z(a))throw Error("Inputted board not valid.");
const l=y(a);if(l){const g=Date.now();let h=E(a,l[0],l[1]);console.log(`solve time: ${Date.now()-g} ms`);if(!h)throw Error("Unsolvable board.");}H(a)}catch(d){alert(d),console.log(d)}};const c=document.getElementById("Size");c.onchange=()=>{var a=c.value;confirm("Are you sure? This will erase any data you have currently entered.")?(w=parseInt(a,10),I.removeChild(document.getElementsByTagName("tbody")[0]),N()):c.value=w.toString(10)};const b=document.getElementById("Solver");b.onchange=()=>{var a=
b.value;switch(a){case "backtracking":E=v;break;case "localSearch":E=J;break;case "DLX":break;default:alert(`${a} is not a supported solving method!`)}};for(const a of document.getElementsByClassName("lb1"))a.onchange=()=>D(a,a.children[0])};
