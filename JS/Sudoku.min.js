var p=[e,n];function q(){var a=u();if(!v(a))throw Error("Inputted board not valid.");const b=w(a);if(b){if(a=x(a,b[0],b[1]))return a;throw Error("Unsolvable board.");}}var y;function x(a,b,c){var d;for(let f=1;f<z**2+1;f++)if(a[b][c]=f,A(a,b,c))if(d=w(a)){if(d=x(a,d[0],d[1]))return!0}else return y=a,!0;a[b][c]=-1;return!1}
function u(){var a=document.getElementById("board"),b=[];for(let c=0;c<z**2;c++){let d=a.rows[c],f=[];for(let h=0;h<z**2;h++){let g=d.cells[h].children[0].value;0<g?f.push(Number(g)):f.push(-1)}b.push(f)}return b}function v(a,b=null){if(b)for(var c of b){if(!A(a,c[0],c[1]))return!1}else for(b=0;b<z*z;b++)for(c=0;c<z*z;c++)if(!A(a,b,c))return!1;return!0}
function A(a,b,c){let d=a[b][c];if(d>z**2)throw Error(`Value ${d} on row ${b+1}, column ${c+1} too large.`);if(0<d)for(const f of p)if(!f(a,b,c,d))return!1;return!0}function e(a,b,c,d){for(let f=0;f<z*z;f++)if(d==a[f][c]&&f!=b||d==a[b][f]&&f!=c)return!1;return!0}function n(a,b,c){let d=Math.floor(b/z)*z,f=Math.floor(c/z)*z;for(let h=0;h<z;h++)for(let g=0;g<z;g++)if((h+d!=b||g+f!=c)&&a[h+d][g+f]==a[b][c])return!1;return!0}
function B(a,b,c,d){let f=[-2,-2,-1,-1,1,1,2,2],h=[-1,1,-2,2,-2,2,-1,1];for(let g=0;8>g;g++){let k=b+f[g],l=c+h[g];if(0<=k&&k<z**2&&0<=l&&l<z**2&&d==a[k][l])return!1}return!0}function C(a,b,c,d){let f=[-1,-1,-1,0,0,1,1,1],h=[-1,0,1,-1,1,-1,0,1];for(let g=0;8>g;g++){let k=b+f[g],l=c+h[g];if(0<=k&&k<z**2&&0<=l&&l<z**2&&d==a[k][l])return!1}return!0}
function D(a,b,c,d){let f=[-1,0,0,1],h=[0,-1,1,0];for(let g=0;4>g;g++){let k=b+f[g],l=c+h[g];if(0<=k&&k<z**2&&0<=l&&l<z**2&&(d+1==a[k][l]||d-1==a[k][l]))return!1}return!0}function E(a,b){let c=b.value;b.checked?(a.className="col2",a=d=>{p.push(d)}):(a.className="lb1",a=d=>{p.splice(p.indexOf(d),1)});switch(c){case "1":a(B);break;case "2":a(C);break;case "3":a(D);break;default:alert("Uh-oh! Something broke!")}}
function w(a){for(let b=0;b<z**2;b++)for(let c=0;c<z**2;c++)if(1>a[b][c])return[b,c];return!1}let F=()=>q();function G(a=y){for(let b=0;b<z**2;b++){let c=J.rows[b];for(let d=0;d<z**2;d++)c.cells[d].children[0].value=a[b][d]}}
function K(){let a=u();if(!v(a))throw Error("Inputted board not valid.");var b;let c=[];for(;b=w(a);)a[b[0]][b[1]]=L(a,b[0],b[1]),c.push(b);b=1E3*2**z;for(let d=0;d<b;d++){G(a);let f=c[Math.floor(Math.random()*c.length)];M(a,f[0],f[1])&&(a[f[0]][f[1]]=L(a,f[0],f[1]));if(v(a,c)){y=a;return}}throw Error(`${b} iterations exceeded without finding a solution.`);}
function M(a,b,c,d=a[b][c]){if(d>z**2)throw Error(`Value ${d} on row ${b+1}, column ${c+1} too large.`);let f=0;if(0<d)for(const h of N.get(100*b+c))d==a[h[0]][h[1]]&&f++;return f}function L(a,b,c){const d=z**2;let f=1,h=Infinity;for(let g=1;g<=d;g++){let k=M(a,b,c,g);k<h&&(h=k,f=g)}return f};let z=3,O=!1;const J=document.getElementById("board"),N=new Map;
function P(){for(let l=0;l<z**2;l++){let Q=J.insertRow(l);0==l%z&&(O=!O);for(let m=0;m<z**2;m++){(0<m||0==z%2)&&0==m%z&&(O=!O);Q.insertCell(m).innerHTML=O?"<input inputmode='numeric' size='1' maxlength='2' autocomplete='off' class='col1'>":"<input inputmode='numeric' size='1' maxlength='2' autocomplete='off' class='col2'>";var a=N,b=a.set,c=100*l+m,d=l,f=m,h=d,g=f,k=[];let H=Math.floor(h/z)*z,I=Math.floor(g/z)*z;for(let r=0;r<z;r++)for(let t=0;t<z;t++)r+H==h&&t+I==g||k.push([r+H,t+I]);h=k;g=[];for(k=
0;k<z**2;k++)k!=d&&g.push([k,f]),k!=f&&g.push([d,k]);b.call(a,c,new Set(h.concat(g)))}}O=!1}
document.body.onload=()=>{P();document.getElementById("cboard").onclick=()=>{confirm("Are you sure? This will erase any data you have currently entered.")&&(J.removeChild(document.getElementsByTagName("tbody")[0]),P())};document.getElementById("sboard").onclick=()=>{try{F(),G()}catch(c){alert(c),console.log(c)}};const a=document.getElementById("Size");a.onchange=()=>{var c=a.value;confirm("Are you sure? This will erase any data you have currently entered.")?(z=c,J.removeChild(document.getElementsByTagName("tbody")[0]),
P()):a.value=z};const b=document.getElementById("Solver");b.onchange=()=>{var c=b.value;switch(c){case "backtracking":F=q;break;case "localSearch":F=K;break;default:alert(`${c} is not a supported solving method!`)}};for(const c of document.getElementsByClassName("lb1"))c.onchange=()=>E(c,c.children[0])};
